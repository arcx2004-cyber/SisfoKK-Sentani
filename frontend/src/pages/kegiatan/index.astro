---
import Layout from '../../layouts/Layout.astro';
import { fetchKegiatan, formatDate, getImageUrl } from '../../lib/api';

const kegiatan = await fetchKegiatan();
const displayKegiatan = kegiatan;

function getDateParts(dateString: string) {
  const date = new Date(dateString);
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
  return {
    day: date.getDate().toString().padStart(2, '0'),
    month: months[date.getMonth()]
  };
}

function getCardColor(index: number) {
  const colors = [
    { border: 'var(--primary-500)', bg: 'var(--primary-100)', textDark: 'var(--primary-700)', textLight: 'var(--primary-600)' },
    { border: 'var(--primary-500)', bg: 'var(--primary-100)', textDark: 'var(--primary-700)', textLight: 'var(--primary-600)' },
    { border: 'var(--warning)', bg: '#fef3c7', textDark: '#b45309', textLight: '#d97706' },
    { border: 'var(--success)', bg: '#d1fae5', textDark: '#047857', textLight: '#10b981' },
  ];
  return colors[index % colors.length];
}
---

<Layout title="Kegiatan">
  <section class="hero" style="min-height: 300px;">
    <div class="hero-content">
      <span class="hero-badge">üìÖ Agenda</span>
      <h1 class="hero-title">Kegiatan Sekolah</h1>
      <p class="hero-subtitle">Agenda dan kegiatan yang berlangsung di Sekolah Kalam Kudus</p>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="section-header">
        <span class="section-badge">Jadwal</span>
        <h2 class="section-title">Kegiatan Mendatang</h2>
      </div>

      <div class="events-grid">
        {displayKegiatan.map((item, index) => {
          const dateParts = getDateParts(item.tanggal_mulai);
          const color = getCardColor(index);
          return (
            <div class="card event-card" style={`border-left: 4px solid ${color.border};`}>
               <a href={`/kegiatan/${item.slug}`} class="event-link">
                <div class="event-date" style={`background: ${color.bg};`}>
                  <div class="event-day" style={`color: ${color.textDark};`}>{dateParts.day}</div>
                  <div class="event-month" style={`color: ${color.textLight};`}>{dateParts.month}</div>
                </div>
                <div class="event-content">
                  <h3 class="card-title">{item.title}</h3>
                  <p class="card-desc">{item.description || item.title}</p>
                  {item.lokasi && (
                    <p class="event-location">üìç {item.lokasi}</p>
                  )}
                </div>
              </a>
            </div>
          );
        })}
      </div>
    </div>
  </section>

  <!-- RE-DESIGNED: Kalender Akademik Section -->
  <section class="section academic-section">
    <div class="container">
      <div class="section-header">
        <span class="section-badge">Kalender</span>
        <h2 class="section-title">Kalender Akademik</h2>
        <p class="section-desc">Jadwal penting operasional sekolah selama satu semester</p>
      </div>

      <div class="calendar-cards">
        {[
          { date: "Januari 2026", event: "Pembukaan Semester Genap", icon: "üìñ", color: "blue" },
          { date: "Februari 2026", event: "Ujian Tengah Semester", icon: "üìù", color: "orange" },
          { date: "Maret 2026", event: "Libur Paskah & Wafat Isa Almasih", icon: "‚ú®", color: "purple" },
          { date: "April 2026", event: "Ujian Akhir Semester", icon: "‚úçÔ∏è", color: "red" },
          { date: "Mei 2026", event: "Persiapan Kelulusan & Kenaikan", icon: "üéì", color: "green" },
          { date: "Juni 2026", event: "Wisuda & Penerimaan Raport", icon: "gold" }
        ].map((item) => (
          <div class={`calendar-card ${item.color || 'blue'}`}>
            <div class="calendar-icon">{item.icon || 'üìÖ'}</div>
            <div class="calendar-info">
              <h4 class="calendar-date">{item.date}</h4>
              <p class="calendar-event">{item.event}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>
  
  <style>
    .events-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 2rem;
        max-width: 1000px;
        margin: 0 auto;
    }
    @media (max-width: 640px) {
        .events-grid {
            grid-template-columns: 1fr;
        }
    }
    .event-card {
        padding: 0 !important;
        overflow: hidden;
        transition: transform 0.2s;
    }
    .event-card:hover {
        transform: translateY(-3px);
    }
    .event-link {
        display: flex; 
        gap: 1.5rem; 
        align-items: flex-start; 
        padding: 1.5rem; 
        text-decoration: none; 
        color: inherit;
        height: 100%;
    }
    .event-date {
        padding: 1rem; 
        border-radius: var(--radius); 
        text-align: center; 
        min-width: 80px;
        flex-shrink: 0;
    }
    .event-day {
        font-size: 1.75rem; 
        font-weight: 800;
        line-height: 1;
    }
    .event-month {
        font-size: 0.875rem; 
        font-weight: 600;
        text-transform: uppercase;
        margin-top: 0.25rem;
    }
    .event-content {
        flex-grow: 1;
    }
    .event-location {
        font-size: 0.875rem; 
        color: var(--gray-500); 
        margin-top: 0.5rem;
    }

    .academic-section {
        background: var(--gray-50);
    }

    .calendar-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        max-width: 1000px;
        margin: 0 auto;
    }

    .calendar-card {
        background: white;
        padding: 1.5rem;
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        gap: 1.25rem;
        box-shadow: var(--shadow-sm);
        border-bottom: 4px solid transparent;
        transition: all 0.3s;
    }

    .calendar-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-md);
    }

    .calendar-icon {
        font-size: 2rem;
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--gray-100);
        border-radius: var(--radius);
        flex-shrink: 0;
    }

    .calendar-date {
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 0.25rem;
        font-size: 1.1rem;
    }

    .calendar-event {
        color: var(--gray-600);
        font-size: 0.95rem;
        line-height: 1.4;
    }

    /* Colors */
    .blue { border-bottom-color: #3b82f6; }
    .orange { border-bottom-color: #f97316; }
    .purple { border-bottom-color: #a855f7; }
    .red { border-bottom-color: #ef4444; }
    .green { border-bottom-color: #22c55e; }
    .gold { border-bottom-color: #eab308; }

    .blue .calendar-icon { background: #eff6ff; }
    .orange .calendar-icon { background: #fff7ed; }
    .purple .calendar-icon { background: #faf5ff; }
    .red .calendar-icon { background: #fef2f2; }
    .green .calendar-icon { background: #f0fdf4; }
    .gold .calendar-icon { background: #fefce8; }
  </style>
</Layout>
