---
import Layout from '../layouts/Layout.astro';
import { fetchSliders, fetchUnits, fetchNews, fetchSettings, getUnitIcon, formatDate, getImageUrl } from '../lib/api';

// Fetch data from API
const settings = await fetchSettings();
const allSliders = await fetchSliders();
const sliders = allSliders.filter(s => s.is_active);
const units = await fetchUnits();
const news = await fetchNews(3);

const activeSlider = sliders.length > 0 ? sliders[0] : null;

// Fallback data for units if API returns empty
const displayUnits = units.length > 0 ? units : [
  { id: 1, nama: 'TK', kode: 'TK', deskripsi: 'Pendidikan Anak Usia Dini dengan pendekatan bermain sambil belajar', urutan: 1, is_active: true },
  { id: 2, nama: 'SD', kode: 'SD', deskripsi: 'Pendidikan Dasar 6 tahun dengan kurikulum terpadu dan pendidikan karakter', urutan: 2, is_active: true },
  { id: 3, nama: 'SMP', kode: 'SMP', deskripsi: 'Pendidikan Menengah Pertama dengan pengembangan akademik dan life skills', urutan: 3, is_active: true },
];

// Fallback news if API returns empty
const displayNews = news.length > 0 ? news : [
  { id: 1, judul: 'PPDB 2026/2027 Resmi Dibuka', slug: 'ppdb-2026', ringkasan: 'Pendaftaran Peserta Didik Baru untuk tahun ajaran 2026/2027 telah resmi dibuka...', featured_image: 'https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=400&h=200&fit=crop', published_at: '2026-01-12' },
  { id: 2, judul: 'Siswa Raih Medali Olimpiade Sains', slug: 'olimpiade-sains', ringkasan: 'Siswa SMP Kalam Kudus berhasil meraih medali emas dalam Olimpiade Sains Nasional...', featured_image: 'https://images.unsplash.com/photo-1577896851231-70ef18881754?w=400&h=200&fit=crop', published_at: '2026-01-08' },
  { id: 3, judul: 'Perayaan Natal Bersama', slug: 'natal-2025', ringkasan: 'Seluruh civitas akademika merayakan Natal bersama dengan penuh sukacita...', featured_image: 'https://images.unsplash.com/photo-1509062522246-3755977927d7?w=400&h=200&fit=crop', published_at: '2025-12-25' },
];
---

<Layout title="Home">
  <!-- Hero Slider -->
  <section class="hero-slider swiper">
    <div class="swiper-wrapper">
      {sliders.length > 0 ? sliders.map((slider) => (
        <div class="swiper-slide">
          <div class="hero" style={`background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('${getImageUrl(slider.gambar, '')}'); background-size: cover; background-position: center;`}>
            <div class="hero-content">
              <span class="hero-badge">ðŸŽ“ Selamat Datang di</span>
              <h1 class="hero-title">{slider.judul}</h1>
              <p class="hero-subtitle">"{slider.deskripsi || settings.school_motto || 'Dengan Kasih & Disiplin Meningkatkan Prestasi'}"</p>
              <div class="hero-buttons">
                <a href={slider.link || '/ppdb'} class="btn btn-primary">Daftar PPDB 2026</a>
                <a href="/profile" class="btn btn-outline">Tentang Kami</a>
              </div>
            </div>
          </div>
        </div>
      )) : (
        <div class="swiper-slide">
          <div class="hero">
            <div class="hero-content">
              <span class="hero-badge">ðŸŽ“ Selamat Datang di</span>
              <h1 class="hero-title">{settings.school_name || 'Sekolah Kristen Kalam Kudus Sentani'}</h1>
              <p class="hero-subtitle">"{settings.school_motto || 'Dengan Kasih & Disiplin Meningkatkan Prestasi'}"</p>
              <div class="hero-buttons">
                <a href="/ppdb" class="btn btn-primary">Daftar PPDB 2026</a>
                <a href="/profile" class="btn btn-outline">Tentang Kami</a>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
    <!-- Swiper controls -->
    <div class="swiper-pagination"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </section>

  <!-- Stats Section -->
  <section class="stats">
    <div class="container">
      <ul class="stats-grid">
        <li class="stat">
          <div class="stat-number">{displayUnits.length}</div>
          <div class="stat-label">Unit Sekolah</div>
        </li>
        <li class="stat">
          <div class="stat-number">50+</div>
          <div class="stat-label">Tenaga Pendidik</div>
        </li>
        <li class="stat">
          <div class="stat-number">500+</div>
          <div class="stat-label">Siswa Aktif</div>
        </li>
        <li class="stat">
          <div class="stat-number">30+</div>
          <div class="stat-label">Tahun Berdiri</div>
        </li>
      </ul>
    </div>
  </section>

  <!-- Units Section -->
  <section class="section">
    <div class="container">
      <div class="section-header">
        <span class="section-badge">Unit Pendidikan</span>
        <h2 class="section-title">Jenjang Pendidikan Kami</h2>
        <p class="section-desc">Menyediakan pendidikan berkualitas dari Taman Kanak-Kanak hingga Sekolah Menengah Pertama</p>
      </div>

      <div class="grid grid-3">
        {displayUnits.map((unit) => (
          <div class="unit-card">
            <div class="unit-icon">{getUnitIcon(unit.kode)}</div>
            <h3 class="unit-name">{unit.nama}</h3>
            <p class="unit-desc">{unit.deskripsi || `Unit ${unit.nama} Sekolah Kalam Kudus Sentani`}</p>
            
            <ul class="card-list">
              {unit.kode === 'TK' && (
                <>
                  <li>Pendidikan berbasis kasih</li>
                  <li>Pengembangan motorik & kreativitas</li>
                  <li>Pembentukan karakter sejak dini</li>
                </>
              )}
              {unit.kode === 'SD' && (
                <>
                  <li>Kurikulum Nasional Terpadu</li>
                  <li>Program penguatan karakter</li>
                  <li>Ekstrakurikuler yang beragam</li>
                </>
              )}
              {unit.kode === 'SMP' && (
                <>
                  <li>Persiapan akademik unggulan</li>
                  <li>Pengembangan minat dan bakat</li>
                  <li>Kepemimpinan & kemandirian</li>
                </>
              )}
            </ul>

            <a href={`/unit/${unit.kode.toLowerCase()}`} class="btn btn-primary">Selengkapnya</a>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="section" style="background: var(--gray-100);">
    <div class="container">
      <div class="section-header">
        <span class="section-badge">Keunggulan</span>
        <h2 class="section-title">Mengapa Memilih Kami?</h2>
        <p class="section-desc">Komitmen kami untuk memberikan pendidikan terbaik berbasis iman Kristiani</p>
      </div>

      <div class="grid grid-4">
        <div class="card">
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
          </div>
          <h3 class="card-title">Kurikulum Terpadu</h3>
          <p class="card-desc">Menggabungkan kurikulum nasional dengan nilai-nilai Kristiani</p>
          <ul class="feature-list">
            <li>Kurikulum Nasional</li>
            <li>Nilai-nilai Kristiani</li>
            <li>Pembelajaran Kontekstual</li>
          </ul>
        </div>

        <div class="card">
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.436 60.436 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.905 59.905 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0112 13.489a50.702 50.702 0 017.74-3.342" />
            </svg>
          </div>
          <h3 class="card-title">Guru Berkualitas</h3>
          <p class="card-desc">Tenaga pengajar profesional dan berdedikasi tinggi</p>
          <ul class="feature-list">
            <li>Sertifikasi Pendidik</li>
            <li>Pelatihan Berkala</li>
            <li>Panggilan Pelayanan</li>
          </ul>
        </div>

        <div class="card">
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
            </svg>
          </div>
          <h3 class="card-title">Pendidikan Karakter</h3>
          <p class="card-desc">Membentuk karakter Kristiani yang kuat dan bermoral</p>
          <ul class="feature-list">
            <li>Integritas</li>
            <li>Disiplin Diri</li>
            <li>Kepedulian Sosial</li>
          </ul>
        </div>

        <div class="card">
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0112 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5" />
            </svg>
          </div>
          <h3 class="card-title">Fasilitas Lengkap</h3>
          <p class="card-desc">Ruang kelas nyaman, laboratorium, dan perpustakaan</p>
          <ul class="feature-list">
            <li>Gedung Milik Sendiri</li>
            <li>Lab Komputer & Sains</li>
            <li>Lapangan Olahraga</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="cta">
    <div class="container">
      <h2 class="cta-title">Bergabunglah Bersama Kami!</h2>
      <p class="cta-desc">Pendaftaran Peserta Didik Baru (PPDB) Tahun Ajaran 2026/2027 telah dibuka</p>
      <a href="/ppdb" class="btn">Daftar Sekarang</a>
    </div>
  </section>

  <!-- News Section -->
  <section class="section">
    <div class="container">
      <div class="section-header">
        <span class="section-badge">Berita Terbaru</span>
        <h2 class="section-title">Kabar Sekolah</h2>
        <p class="section-desc">Informasi terkini seputar kegiatan dan prestasi sekolah</p>
      </div>

      <div class="grid grid-3">
        {displayNews.map((item) => (
          <article class="news-card">
            <img src={getImageUrl(item.featured_image, 'https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=400&h=200&fit=crop')} alt={item.judul} />
            <div class="news-card-content">
              <span class="news-card-date">{formatDate(item.published_at)}</span>
              <h3 class="news-card-title">{item.judul}</h3>
              <p class="news-card-excerpt">{item.ringkasan || item.judul}</p>
            </div>
          </article>
        ))}
      </div>

      <div style="text-align: center; margin-top: 2rem;">
        <a href="/berita" class="btn btn-primary">Lihat Semua Berita</a>
      </div>
    </div>
  </section>
</Layout>

<script is:inline>
  // Initialize Swiper
  document.addEventListener('DOMContentLoaded', function() {
    new Swiper('.hero-slider', {
      loop: true,
      autoplay: {
        delay: 5000,
        disableOnInteraction: false,
      },
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
      effect: 'fade',
      fadeEffect: {
        crossFade: true
      },
    });
  });
</script>

<style>
  .hero-slider {
    width: 100%;
    height: auto;
  }
  
  .hero-slider :global(.swiper-pagination-bullet) {
    background: white;
    opacity: 0.5;
  }
  
  .hero-slider :global(.swiper-pagination-bullet-active) {
    background: var(--primary-500);
    opacity: 1;
  }
  
  .hero-slider :global(.swiper-button-next),
  .hero-slider :global(.swiper-button-prev) {
    color: white;
    background: rgba(0, 0, 0, 0.2);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    backdrop-filter: blur(4px);
  }
  
  .hero-slider :global(.swiper-button-next:after),
  .hero-slider :global(.swiper-button-prev:after) {
    font-size: 1.5rem;
  }

  .card-list, .feature-list {
    list-style: none;
    padding: 0;
    margin: 1.25rem 0;
    text-align: left;
  }
  
  .card-list li, .feature-list li {
    position: relative;
    padding-left: 1.5rem;
    margin-bottom: 0.625rem;
    color: var(--gray-600);
    font-size: 0.95rem;
    line-height: 1.4;
  }
  
  .card-list li::before, .feature-list li::before {
    content: "â†’";
    position: absolute;
    left: 0;
    color: var(--primary-500);
    font-weight: 700;
  }

  .stats-grid {
    list-style: none;
  }

  .stat {
    border: 2px solid rgba(255, 255, 255, 0.4);
    padding: 2.5rem 1.5rem;
    border-radius: var(--radius-lg);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(4px);
  }

  .stat:hover {
    border-color: rgba(255, 255, 255, 1);
    background: rgba(255, 255, 255, 0.12);
    transform: translateY(-8px);
    box-shadow: 0 12px 24px -10px rgba(0, 0, 0, 0.3);
  }

  /* Adjustments for better spacing with lists */
  .unit-card {
    display: flex;
    flex-direction: column;
  }
  
  .unit-card .btn {
    margin-top: auto;
  }

  .card {
    display: flex;
    flex-direction: column;
  }
</style>
