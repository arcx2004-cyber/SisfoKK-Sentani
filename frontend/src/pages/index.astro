---
import Layout from '../layouts/Layout.astro';
import { fetchSliders, fetchUnits, fetchNews, getUnitIcon, formatDate, getImageUrl } from '../lib/api';

// Fetch data from API
const sliders = await fetchSliders();
const units = await fetchUnits();
const news = await fetchNews(3);

// Fallback data for units if API returns empty
const displayUnits = units.length > 0 ? units : [
  { id: 1, nama: 'TK', kode: 'TK', deskripsi: 'Pendidikan Anak Usia Dini dengan pendekatan bermain sambil belajar', urutan: 1, is_active: true },
  { id: 2, nama: 'SD', kode: 'SD', deskripsi: 'Pendidikan Dasar 6 tahun dengan kurikulum terpadu dan pendidikan karakter', urutan: 2, is_active: true },
  { id: 3, nama: 'SMP', kode: 'SMP', deskripsi: 'Pendidikan Menengah Pertama dengan pengembangan akademik dan life skills', urutan: 3, is_active: true },
];

// Fallback news if API returns empty
const displayNews = news.length > 0 ? news : [
  { id: 1, title: 'PPDB 2026/2027 Resmi Dibuka', slug: 'ppdb-2026', excerpt: 'Pendaftaran Peserta Didik Baru untuk tahun ajaran 2026/2027 telah resmi dibuka...', image: 'https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=400&h=200&fit=crop', published_at: '2026-01-12' },
  { id: 2, title: 'Siswa Raih Medali Olimpiade Sains', slug: 'olimpiade-sains', excerpt: 'Siswa SMP Kalam Kudus berhasil meraih medali emas dalam Olimpiade Sains Nasional...', image: 'https://images.unsplash.com/photo-1577896851231-70ef18881754?w=400&h=200&fit=crop', published_at: '2026-01-08' },
  { id: 3, title: 'Perayaan Natal Bersama', slug: 'natal-2025', excerpt: 'Seluruh civitas akademika merayakan Natal bersama dengan penuh sukacita...', image: 'https://images.unsplash.com/photo-1509062522246-3755977927d7?w=400&h=200&fit=crop', published_at: '2025-12-25' },
];
---

<Layout title="Home">
  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <span class="hero-badge">ðŸŽ“ Selamat Datang di</span>
      <h1 class="hero-title">Sekolah Kristen Kalam Kudus Sentani</h1>
      <p class="hero-subtitle">"Dengan Kasih & Disiplin Meningkatkan Prestasi"</p>
      <div class="hero-buttons">
        <a href="/ppdb" class="btn btn-primary">Daftar PPDB 2026</a>
        <a href="/profile" class="btn btn-outline">Tentang Kami</a>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="stats">
    <div class="container">
      <div class="stats-grid">
        <div class="stat">
          <div class="stat-number">{displayUnits.length}</div>
          <div class="stat-label">Unit Sekolah</div>
        </div>
        <div class="stat">
          <div class="stat-number">50+</div>
          <div class="stat-label">Tenaga Pendidik</div>
        </div>
        <div class="stat">
          <div class="stat-number">500+</div>
          <div class="stat-label">Siswa Aktif</div>
        </div>
        <div class="stat">
          <div class="stat-number">30+</div>
          <div class="stat-label">Tahun Berdiri</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Units Section -->
  <section class="section">
    <div class="container">
      <div class="section-header">
        <span class="section-badge">Unit Pendidikan</span>
        <h2 class="section-title">Jenjang Pendidikan Kami</h2>
        <p class="section-desc">Menyediakan pendidikan berkualitas dari Taman Kanak-Kanak hingga Sekolah Menengah Pertama</p>
      </div>

      <div class="grid grid-3">
        {displayUnits.map((unit) => (
          <div class="unit-card">
            <div class="unit-icon">{getUnitIcon(unit.kode)}</div>
            <h3 class="unit-name">{unit.nama}</h3>
            <p class="unit-desc">{unit.deskripsi || `Unit ${unit.nama} Sekolah Kalam Kudus Sentani`}</p>
            <a href={`/unit/${unit.kode.toLowerCase()}`} class="btn btn-primary">Selengkapnya</a>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="section" style="background: var(--gray-100);">
    <div class="container">
      <div class="section-header">
        <span class="section-badge">Keunggulan</span>
        <h2 class="section-title">Mengapa Memilih Kami?</h2>
        <p class="section-desc">Komitmen kami untuk memberikan pendidikan terbaik berbasis iman Kristiani</p>
      </div>

      <div class="grid grid-4">
        <div class="card">
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
          </div>
          <h3 class="card-title">Kurikulum Terpadu</h3>
          <p class="card-desc">Menggabungkan kurikulum nasional dengan nilai-nilai Kristiani</p>
        </div>

        <div class="card">
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.436 60.436 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.905 59.905 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0112 13.489a50.702 50.702 0 017.74-3.342" />
            </svg>
          </div>
          <h3 class="card-title">Guru Berkualitas</h3>
          <p class="card-desc">Tenaga pengajar profesional dan berdedikasi tinggi</p>
        </div>

        <div class="card">
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
            </svg>
          </div>
          <h3 class="card-title">Pendidikan Karakter</h3>
          <p class="card-desc">Membentuk karakter Kristiani yang kuat dan bermoral</p>
        </div>

        <div class="card">
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0112 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5" />
            </svg>
          </div>
          <h3 class="card-title">Fasilitas Lengkap</h3>
          <p class="card-desc">Ruang kelas nyaman, laboratorium, dan perpustakaan</p>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="cta">
    <div class="container">
      <h2 class="cta-title">Bergabunglah Bersama Kami!</h2>
      <p class="cta-desc">Pendaftaran Peserta Didik Baru (PPDB) Tahun Ajaran 2026/2027 telah dibuka</p>
      <a href="/ppdb" class="btn">Daftar Sekarang</a>
    </div>
  </section>

  <!-- News Section -->
  <section class="section">
    <div class="container">
      <div class="section-header">
        <span class="section-badge">Berita Terbaru</span>
        <h2 class="section-title">Kabar Sekolah</h2>
        <p class="section-desc">Informasi terkini seputar kegiatan dan prestasi sekolah</p>
      </div>

      <div class="grid grid-3">
        {displayNews.map((item) => (
          <article class="news-card">
            <img src={getImageUrl(item.image, 'https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=400&h=200&fit=crop')} alt={item.title} />
            <div class="news-card-content">
              <span class="news-card-date">{formatDate(item.published_at)}</span>
              <h3 class="news-card-title">{item.title}</h3>
              <p class="news-card-excerpt">{item.excerpt || item.title}</p>
            </div>
          </article>
        ))}
      </div>

      <div style="text-align: center; margin-top: 2rem;">
        <a href="/berita" class="btn btn-primary">Lihat Semua Berita</a>
      </div>
    </div>
  </section>
</Layout>
