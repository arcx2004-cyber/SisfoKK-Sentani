---
import Layout from '../../layouts/Layout.astro';
import { fetchNews, formatDate, getImageUrl } from '../../lib/api';

const news = await fetchNews();

const displayNews = news.length > 0 ? news : [
  { id: 1, judul: 'PPDB 2026/2027 Resmi Dibuka', slug: 'ppdb-2026', ringkasan: 'Pendaftaran Peserta Didik Baru...', featured_image: '', published_at: '2026-01-12' }
];
---

<Layout title=Berita Sekolah>
  <section class=hero style=min-height: 300px;>
    <div class=hero-content>
      <span class=hero-badge>ðŸ“° Informasi</span>
      <h1 class=hero-title>Berita Sekolah</h1>
      <p class=hero-subtitle>Kabar terbaru seputar kegiatan dan prestasi Sekolah Kalam Kudus</p>
    </div>
  </section>

  <section class=section>
    <div class=container>
      <div class=news-grid>
        {displayNews.map((item) => (
          <article class=news-card>
            <a href={`/berita/${item.slug}`} class=news-card-link>
              <div class=news-image-wrapper>
                  <img src={getImageUrl(item.featured_image, 'https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=400&h=200&fit=crop')} alt={item.judul} />
              </div>
              <div class=news-card-content>
                <span class=news-card-date>{formatDate(item.published_at)}</span>
                <h3 class=news-card-title>{item.judul}</h3>
                <p class=news-card-excerpt>{item.ringkasan || item.judul}</p>
              </div>
            </a>
          </article>
        ))}
      </div>
    </div>
  </section>
  
  <style>
    .news-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
    }
    .news-card {
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        transition: transform 0.2s, box-shadow 0.2s;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    .news-card-link {
        text-decoration: none;
        color: inherit;
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    .news-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
    }
    .news-image-wrapper {
        height: 200px;
        overflow: hidden;
    }
    .news-image-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }
    .news-card:hover img {
        transform: scale(1.05);
    }
    .news-card-content {
        padding: 1.5rem;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }
    .news-card-date {
        font-size: 0.875rem; 
        color: var(--primary-600); 
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    .news-card-title {
        margin: 0 0 0.5rem 0; 
        font-size: 1.25rem;
        line-height: 1.4;
    }
    .news-card-excerpt {
        color: var(--gray-600); 
        font-size: 0.95rem;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
  </style>
</Layout>
