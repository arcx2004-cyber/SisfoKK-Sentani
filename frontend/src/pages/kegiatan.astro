---
import Layout from '../layouts/Layout.astro';
import { fetchKegiatan, formatDate, getImageUrl } from '../lib/api';

// Fetch kegiatan from API
const kegiatan = await fetchKegiatan();

// Fallback data if API returns empty
const displayKegiatan = kegiatan.length > 0 ? kegiatan : [
  { id: 1, title: 'Pembukaan Semester Genap', slug: 'pembukaan-semester', description: 'Upacara pembukaan semester genap tahun ajaran 2025/2026', tanggal_mulai: '2026-01-15', lokasi: 'Lapangan Sekolah' },
  { id: 2, title: 'Rapat Orang Tua Murid', slug: 'rapat-ortu', description: 'Pertemuan dengan wali murid untuk pembahasan program semester', tanggal_mulai: '2026-01-20', lokasi: 'Aula Sekolah' },
  { id: 3, title: 'Lomba Literasi', slug: 'lomba-literasi', description: 'Kompetisi menulis dan membaca untuk semua jenjang', tanggal_mulai: '2026-01-25', lokasi: 'Perpustakaan' },
  { id: 4, title: 'Field Trip ke Museum', slug: 'field-trip', description: 'Kunjungan edukatif ke Museum Loka Budaya Papua', tanggal_mulai: '2026-02-01', lokasi: 'Jayapura' },
];

// Helper to get date parts
function getDateParts(dateString: string) {
  const date = new Date(dateString);
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
  return {
    day: date.getDate().toString().padStart(2, '0'),
    month: months[date.getMonth()]
  };
}

// Helper to get card color based on index
function getCardColor(index: number) {
  const colors = [
    { border: 'var(--primary-500)', bg: 'var(--primary-100)', textDark: 'var(--primary-700)', textLight: 'var(--primary-600)' },
    { border: 'var(--primary-500)', bg: 'var(--primary-100)', textDark: 'var(--primary-700)', textLight: 'var(--primary-600)' },
    { border: 'var(--warning)', bg: '#fef3c7', textDark: '#b45309', textLight: '#d97706' },
    { border: 'var(--success)', bg: '#d1fae5', textDark: '#047857', textLight: '#10b981' },
  ];
  return colors[index % colors.length];
}
---

<Layout title="Kegiatan">
  <section class="hero" style="min-height: 300px;">
    <div class="hero-content">
      <span class="hero-badge">üìÖ Agenda</span>
      <h1 class="hero-title">Kegiatan Sekolah</h1>
      <p class="hero-subtitle">Agenda dan kegiatan yang berlangsung di Sekolah Kalam Kudus</p>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="section-header">
        <span class="section-badge">Jadwal</span>
        <h2 class="section-title">Kegiatan Mendatang</h2>
      </div>

      <div class="grid grid-2" style="max-width: 900px; margin: 0 auto;">
        {displayKegiatan.map((item, index) => {
          const dateParts = getDateParts(item.tanggal_mulai);
          const color = getCardColor(index);
          return (
            <div class="card" style={`border-left: 4px solid ${color.border};`}>
              <div style="display: flex; gap: 1rem; align-items: flex-start;">
                <div style={`background: ${color.bg}; padding: 1rem; border-radius: var(--radius); text-align: center; min-width: 70px;`}>
                  <div style={`font-size: 1.5rem; font-weight: 800; color: ${color.textDark};`}>{dateParts.day}</div>
                  <div style={`font-size: 0.875rem; color: ${color.textLight};`}>{dateParts.month}</div>
                </div>
                <div>
                  <h3 class="card-title">{item.title}</h3>
                  <p class="card-desc">{item.description || item.title}</p>
                  {item.lokasi && (
                    <p style="font-size: 0.875rem; color: var(--gray-500); margin-top: 0.5rem;">üìç {item.lokasi}</p>
                  )}
                </div>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  </section>

  <section class="section" style="background: var(--gray-100);">
    <div class="container">
      <div class="section-header">
        <span class="section-badge">Kalender</span>
        <h2 class="section-title">Kalender Akademik</h2>
      </div>

      <div class="card" style="max-width: 800px; margin: 0 auto;">
        <h3 class="card-title">Semester Genap 2025/2026</h3>
        <ul style="color: var(--gray-600); line-height: 2;">
          <li><strong>Januari 2026:</strong> Pembukaan Semester Genap</li>
          <li><strong>Februari 2026:</strong> Ujian Tengah Semester</li>
          <li><strong>Maret 2026:</strong> Libur Paskah</li>
          <li><strong>April 2026:</strong> Ujian Akhir Semester</li>
          <li><strong>Mei 2026:</strong> Persiapan Kelulusan</li>
          <li><strong>Juni 2026:</strong> Wisuda & Penerimaan Raport</li>
        </ul>
      </div>
    </div>
  </section>
</Layout>
